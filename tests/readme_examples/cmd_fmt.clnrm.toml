# README Example Test: clnrm fmt command
# Verifies: "fmt - Deterministic TOML formatting with idempotency verification"
# Location in README: Lines 12, 415

[test.metadata]
name = "verify_clnrm_fmt"
description = "Verify 'clnrm fmt' provides deterministic TOML formatting"
version = "1.0.0"

[service.formatter]
plugin = "generic_container"
image = "rust:1.70"
working_dir = "/workspace"

[[scenario]]
name = "fmt_command_formats_toml"
service = "formatter"
run = """
cp /workspace/tests/basic.clnrm.toml /tmp/test.clnrm.toml && \
clnrm fmt /tmp/test.clnrm.toml && \
clnrm fmt /tmp/test.clnrm.toml && \
echo 'Formatting complete'
"""

[[expect.output]]
pattern = "formatted|complete|success"
description = "Should format successfully"

[[expect.status]]
exit_code = 0

[[scenario]]
name = "fmt_is_idempotent"
service = "formatter"
run = """
cp /workspace/tests/basic.clnrm.toml /tmp/test2.clnrm.toml && \
clnrm fmt /tmp/test2.clnrm.toml && \
HASH1=$(sha256sum /tmp/test2.clnrm.toml | cut -d' ' -f1) && \
clnrm fmt /tmp/test2.clnrm.toml && \
HASH2=$(sha256sum /tmp/test2.clnrm.toml | cut -d' ' -f1) && \
test "$HASH1" = "$HASH2" && \
echo "Idempotent: $HASH1 = $HASH2"
"""

[[expect.output]]
pattern = "Idempotent:"
description = "Should produce identical output on repeated formatting"
